<template>
	<div class="-pl-4">
		<div class="flex flex-col md:flex-row items-center justify-between">
			<!-- Sección Izquierda (Icono y Título) -->
			<div class="flex items-center">
				<div class="">
					<svg
						width="30"
						height="30"
						viewBox="0 0 141 145"
						fill="none"
						xmlns="http://www.w3.org/2000/svg">
						<path
							d="M70.3037 133.734C105.719 133.734 134.43 105.095 134.43 69.7668C134.43 34.4389 105.719 5.80005 70.3037 5.80005C34.8879 5.80005 6.17773 34.4389 6.17773 69.7668C6.17773 105.095 34.8879 133.734 70.3037 133.734Z"
							fill="#005DCA" />
						<path
							d="M111.122 53.9568C110.744 55.4826 110.545 57.085 109.94 58.5109C109.237 60.2148 108.324 61.8228 107.22 63.2968C102.961 68.8221 98.5876 74.2582 94.2544 79.7284C94.1423 79.8707 94.0196 80.0067 93.8589 80.1916C93.6749 79.9791 93.5184 79.8091 93.3746 79.6263C88.8552 73.8885 84.1646 68.2951 79.8525 62.4127C72.5374 52.4245 77.9492 38.0012 90.4075 35.3724C99.7296 33.4088 108.705 39.4102 110.763 48.7884C110.906 49.4387 111.01 50.0975 111.131 50.7521L111.122 53.9568ZM93.8293 72.0205C93.99 71.842 94.0661 71.7676 94.1317 71.6847C97.2807 67.7001 100.463 63.743 103.568 59.7223C105.702 56.9596 106.402 53.7889 105.869 50.3334C104.811 43.4819 97.8749 38.7641 91.209 40.375C82.2422 42.5426 78.7063 52.8644 84.4416 60.1516C86.5564 62.8399 88.6882 65.5175 90.8114 68.1995L93.8293 72.0205Z"
							fill="white" />
						<path
							d="M46.2896 79.9072C44.1437 77.2031 42.0677 74.6009 40.0001 71.9796C37.431 68.7257 34.7645 65.5525 32.3266 62.2138C24.9197 52.1106 30.5256 37.6434 42.7809 35.0815C53.9293 32.7467 64.3815 41.9182 63.5329 53.3013C63.2991 56.7682 62.0134 60.0804 59.8485 62.7933C55.41 68.4095 50.9658 74.02 46.516 79.6249L46.2896 79.9072ZM46.2748 71.676C46.3651 71.5978 46.4513 71.5149 46.533 71.4277C49.6693 67.4713 52.8246 63.5298 55.9313 59.5415C58.1152 56.7398 58.8581 53.5433 58.3142 50.0305C57.256 43.2002 50.2978 38.4924 43.6274 40.1098C34.6608 42.2917 31.1372 52.5945 36.8807 59.8769C39.8294 63.6111 42.7851 67.339 45.7478 71.0605C45.9087 71.2579 46.0822 71.451 46.2748 71.676Z"
							fill="white" />
						<path
							d="M53.7566 94.6073C53.7983 98.7694 50.4231 102.268 46.325 102.306C42.2268 102.345 38.8662 98.8911 38.8245 94.6756C38.787 90.5049 42.1581 87.0151 46.2562 86.981C50.3544 86.9468 53.715 90.3875 53.7566 94.6073ZM46.2708 97.1686C46.758 97.1677 47.2342 97.0194 47.6394 96.7422C48.0447 96.465 48.361 96.0714 48.5486 95.6108C48.7363 95.1501 48.7869 94.6429 48.6942 94.1529C48.6014 93.6628 48.3695 93.2118 48.0274 92.8563C47.6853 92.5008 47.2484 92.2568 46.7714 92.1549C46.2944 92.0529 45.7987 92.0976 45.3464 92.2833C44.8941 92.469 44.5054 92.7874 44.2292 93.1986C43.9529 93.6097 43.8014 94.0954 43.7936 94.5945C43.7891 95.2727 44.0474 95.925 44.5118 96.4084C44.9762 96.8917 45.6088 97.1667 46.2708 97.1729V97.1686Z"
							fill="white" />
						<path
							d="M101.302 95.0445C101.162 99.3255 97.7594 102.727 93.7228 102.586C89.5674 102.448 86.2436 98.9265 86.3769 94.8055C86.5186 90.5245 89.9092 87.1505 93.9583 87.2679C98.1033 87.3852 101.433 90.9129 101.302 95.0445ZM93.8583 97.4561C94.3455 97.4468 94.8193 97.2904 95.22 97.0064C95.6208 96.7224 95.9307 96.3234 96.1109 95.8597C96.291 95.396 96.3334 94.8881 96.2326 94.3997C96.1319 93.9114 95.8926 93.4645 95.5447 93.115C95.1968 92.7655 94.7558 92.529 94.2771 92.4352C93.7984 92.3415 93.3034 92.3946 92.8541 92.588C92.4048 92.7813 92.0213 93.1063 91.7517 93.5221C91.4821 93.9379 91.3385 94.4259 91.3388 94.925C91.3465 95.6024 91.6159 96.249 92.0881 96.7234C92.5603 97.1977 93.1968 97.4612 93.8583 97.4561Z"
							fill="white" />
						<path
							d="M57.535 92.2945L64.173 92.2303L64.1764 97.2917L57.5404 97.3563L57.535 92.2945Z"
							fill="white" />
						<path
							d="M66.7248 92.204L73.3495 92.2311L73.4072 96.9883L66.7788 96.9688L66.7248 92.204Z"
							fill="white" />
						<path
							d="M82.599 92.2317L82.5974 97.2812L75.9503 97.3545L75.9523 92.3029L82.599 92.2317Z"
							fill="white" />
						<path
							d="M99.7344 52.3077C99.7118 53.865 99.081 55.3517 97.9768 56.45C96.8726 57.5483 95.3825 58.1711 93.8251 58.1853C90.6172 58.1726 87.9264 55.467 87.9454 52.276C87.9644 49.085 90.6658 46.3773 93.8547 46.3963C95.4125 46.4189 96.8997 47.0499 97.9985 48.1545C99.0972 49.2592 99.7202 50.7498 99.7344 52.3077Z"
							fill="white" />
						<path
							d="M46.3263 57.9008C43.1365 57.9325 40.4194 55.2549 40.3961 52.0436C40.3729 48.8322 43.0395 46.1483 46.2546 46.1124C49.4696 46.0765 52.1467 48.752 52.1847 51.9718C52.2206 55.1579 49.5413 57.8713 46.3263 57.9008Z"
							fill="white" />
					</svg>
				</div>
				
				<h2 class="text-blue-950 ms-2 text-xl md:text-3xl">Ruta de atención al ciudadano</h2>
			</div>
		</div>
		<div class="flex flex-col xl:flex-row gap-3 mb-5">
			<!-- Sección Derecha (Botón) -->
			<ButtonLink link="PerfilCiudadanoPage" textContent="Regresar a perfil del ciudadano" :icon="BackArrowRounded"/>
			

			<!-- Recuadro Blanco (Información del ciudadano) -->
			<div class="flex flex-col xl:flex-row items-center mt-2 gap-2 xl:gap-5 text-xl">

				<div class="ms-3">
					<span class="text-blue-950  font-bold">Ciudadano: </span>
					<span>{{ userInfo.nombrecompleto }}</span>
				</div>
				<div class="ms-2">
					<span class="text-blue-950 font-bold"> Cédula: </span>
					<span>{{ userInfo.documento }}</span>
				</div>
			</div>

			
		</div>
		<div class="bg-white shadow-custom rounded-2xl">
			<table class="w-full !border-separate border-spacing-2 md:p-3">
				<thead>
					<tr class="text-xs">
						<th class="bg-azul-gradian rounded-lg py-2 px-2 md:ps-3">
							<div class="flex items-center">
								<img :src="calendario" alt="calendario">
								<span class="pl-1 md:pl-2 text-white md:text-lg">Fecha</span>
							</div>
						</th>
						<th class="bg-azul-gradian rounded-lg py-2 px-2 md:ps-3">
							<div class="flex items-center">
								<img :src="ticket" alt="ticket">
								<span class="pl-1 md:pl-2 text-white md:text-lg">Ticket</span>
							</div>
						</th>
						<th class="bg-azul-gradian rounded-lg py-2 px-2 md:ps-3">
							<div class="flex items-center">
								<img :src="eyeRounded" alt="eye">
								<span class="pl-1 md:pl-2 text-white md:text-lg">{{ screenSize == "mobile" ? "Ver" : "Visualizar" }}</span>
							</div>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td
							v-if="!fetchData.data || fetchData.data?.lenght == 0"
							colspan="3">
							No hay tickets disponibles
						</td>
					</tr>
					<tr v-for="(events, date) in fetchData.data" :key="date" class="h-32">
						<!-- Columna de Fecha -->
						<td class="p-1 h-full shadow-[0_0_0_1px_rgb(209,213,219)] rounded-xl">
							<div class="h-full py-4 lg:px-4 rounded-xl bg-white text-xs md:text-xl items-start">
								<time class="font-medium md:font-bold text-gray-700">{{ events.fecha_hora }}</time>
							</div>
						</td>

						<!-- Columna de Información del Evento -->
						<td class="h-full shadow-[0_0_0_1px_rgb(209,213,219)] rounded-xl">
							<div class="h-full py-4 px-2 lg:px-4 rounded-xl bg-white flex items-center tracking-tight">
								<div class="leading-3">
									<span class="text-xs md:text-xl">Ticekt 6</span>
									<br>
									<span class="font-bold text-blue-950 text-sm md:text-2xl">
										{{ events.titulo }}
									</span>
									<div>
										<p class="text-xs md:text-lg mt-0">{{ events.contenido }}</p>
									</div>
								</div>
							</div>
						</td>

						<!-- Columna de Visualización -->
						<td class="p-1 h-full shadow-[0_0_0_1px_rgb(209,213,219)] rounded-xl">
							<div class="h-full py-4 px-4 bg-white  flex items-center justify-center">
								<!-- <div
									@click="toggleEventDetails(date)"
									class="cursor-pointer">
									<transition name="fade">
										<svg v-if="!openedGroups[date]" width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
										</svg>
									</transition>
									<transition name="fade">
										<svg v-if="openedGroups[date]" width="39" height="38" viewBox="0 0 39 38" fill="none" xmlns="http://www.w3.org/2000/svg">
										</svg>
									</transition> -->
								<button class="border border-hidden rounded-menu bg-verde-gradient md:w-24 py-1 text-md text-white font-bold hover:cursor-pointer"><img :src="eyebtn" alt="ojo ver mas"> {{ screenSize != "mobile" ? "ver" : "" }}</button>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</template>

<script setup>
import { ref, onMounted, computed } from "vue";
import { useEventStore } from "@/stores/storedataOff";
import BackArrowRounded from "./Icons/fill/BackArrowRounded.vue";
import calendario from "@/assets/images/calendario.svg"
import ticket from "@/assets/images/ticket.svg"
import eyeRounded from "@/assets/images/eyeRounded.svg"
import eyebtn from "@/assets/images/eyebtn.svg";
import { useResponsive } from "@/composables";
import ButtonLink from "./ButtonLink.vue";

const openedGroups = ref({});
const fetchData = ref([]);
const eventStore = useEventStore();
const userInfo = ref({
	nombrecompleto: "Juan Pérez García",
	documento: "1234567890"
});
const { screenSize } = useResponsive()

const host = import.meta.env.VITE_HOST;

const fetchOptions = {
	url: `${host}:8082/api/v1/victimas/ticket`,
	options: {
		method: "GET",
		headers: {
			Accept: "application/json",
		},
	},
};

const getFetchData = async (fetchOptions) => {
	const { url, options } = fetchOptions;
	let newUrl = url + `/${userInfo.value.documento}`;
	console.log(newUrl);

	try {
		const response = await fetch(newUrl, options);
		const json = await response.json();
		if (!response.ok)
			throw {
				error: true,
				errorStatus: response.status,
				errorMsg: response.statusText,
			};
		console.log(json);
		fetchData.value = json;
	} catch (error) {
		if (!error.error) error.error = true;
		console.log(error);
	} finally {
		newUrl = "";
	}

	fetchData.value = {
		data: [
			{
				fecha_hora: "13/07/2023",
				titulo: "Citación audiencia",
				contenido: "Descripción del evento: citación a audiencia para Robert Johnson."
			},
			{
				fecha_hora: "13/07/2023",
				titulo: "Citación audiencia",
				contenido: "Descripción del evento: citación a audiencia para Robert Johnson."
			},
			{
				fecha_hora: "13/07/2023",
				titulo: "Citación audiencia",
				contenido: "Descripción del evento: citación a audiencia para Robert Johnson."
			},
			{
				fecha_hora: "13/07/2023",
				titulo: "Citación audiencia",
				contenido: "Descripción del evento: citación a audiencia para Robert Johnson."
			}
		]
	};
};



const formatDate = (isoDate) => {
	const date = new Date(isoDate);
	return new Intl.DateTimeFormat("es-ES", {
		dateStyle: "medium",
		timeStyle: "short",
	}).format(date);
};

// Función para alternar la visibilidad de los detalles del evento
const toggleEventDetails = (date) => {
	openedGroups.value[date] = !openedGroups.value[date];
};

onMounted(() => {
	getFetchData(fetchOptions);
});
</script>

<style scoped>
/* Aplicar bordes con espaciado */
@import "@/styles/table-styles.css";
</style>
