<template>
	<div class="m-5">
		<div class="flex flex-col md:flex-row items-center justify-between">
			<!-- Sección Izquierda (Icono y Título) -->
			<div class="flex items-center">
				<div class="">
					<svg
						width="30"
						height="30"
						viewBox="0 0 141 145"
						fill="none"
						xmlns="http://www.w3.org/2000/svg">
						<path
							d="M70.3037 133.734C105.719 133.734 134.43 105.095 134.43 69.7668C134.43 34.4389 105.719 5.80005 70.3037 5.80005C34.8879 5.80005 6.17773 34.4389 6.17773 69.7668C6.17773 105.095 34.8879 133.734 70.3037 133.734Z"
							fill="#005DCA" />
						<path
							d="M111.122 53.9568C110.744 55.4826 110.545 57.085 109.94 58.5109C109.237 60.2148 108.324 61.8228 107.22 63.2968C102.961 68.8221 98.5876 74.2582 94.2544 79.7284C94.1423 79.8707 94.0196 80.0067 93.8589 80.1916C93.6749 79.9791 93.5184 79.8091 93.3746 79.6263C88.8552 73.8885 84.1646 68.2951 79.8525 62.4127C72.5374 52.4245 77.9492 38.0012 90.4075 35.3724C99.7296 33.4088 108.705 39.4102 110.763 48.7884C110.906 49.4387 111.01 50.0975 111.131 50.7521L111.122 53.9568ZM93.8293 72.0205C93.99 71.842 94.0661 71.7676 94.1317 71.6847C97.2807 67.7001 100.463 63.743 103.568 59.7223C105.702 56.9596 106.402 53.7889 105.869 50.3334C104.811 43.4819 97.8749 38.7641 91.209 40.375C82.2422 42.5426 78.7063 52.8644 84.4416 60.1516C86.5564 62.8399 88.6882 65.5175 90.8114 68.1995L93.8293 72.0205Z"
							fill="white" />
						<path
							d="M46.2896 79.9072C44.1437 77.2031 42.0677 74.6009 40.0001 71.9796C37.431 68.7257 34.7645 65.5525 32.3266 62.2138C24.9197 52.1106 30.5256 37.6434 42.7809 35.0815C53.9293 32.7467 64.3815 41.9182 63.5329 53.3013C63.2991 56.7682 62.0134 60.0804 59.8485 62.7933C55.41 68.4095 50.9658 74.02 46.516 79.6249L46.2896 79.9072ZM46.2748 71.676C46.3651 71.5978 46.4513 71.5149 46.533 71.4277C49.6693 67.4713 52.8246 63.5298 55.9313 59.5415C58.1152 56.7398 58.8581 53.5433 58.3142 50.0305C57.256 43.2002 50.2978 38.4924 43.6274 40.1098C34.6608 42.2917 31.1372 52.5945 36.8807 59.8769C39.8294 63.6111 42.7851 67.339 45.7478 71.0605C45.9087 71.2579 46.0822 71.451 46.2748 71.676Z"
							fill="white" />
						<path
							d="M53.7566 94.6073C53.7983 98.7694 50.4231 102.268 46.325 102.306C42.2268 102.345 38.8662 98.8911 38.8245 94.6756C38.787 90.5049 42.1581 87.0151 46.2562 86.981C50.3544 86.9468 53.715 90.3875 53.7566 94.6073ZM46.2708 97.1686C46.758 97.1677 47.2342 97.0194 47.6394 96.7422C48.0447 96.465 48.361 96.0714 48.5486 95.6108C48.7363 95.1501 48.7869 94.6429 48.6942 94.1529C48.6014 93.6628 48.3695 93.2118 48.0274 92.8563C47.6853 92.5008 47.2484 92.2568 46.7714 92.1549C46.2944 92.0529 45.7987 92.0976 45.3464 92.2833C44.8941 92.469 44.5054 92.7874 44.2292 93.1986C43.9529 93.6097 43.8014 94.0954 43.7936 94.5945C43.7891 95.2727 44.0474 95.925 44.5118 96.4084C44.9762 96.8917 45.6088 97.1667 46.2708 97.1729V97.1686Z"
							fill="white" />
						<path
							d="M101.302 95.0445C101.162 99.3255 97.7594 102.727 93.7228 102.586C89.5674 102.448 86.2436 98.9265 86.3769 94.8055C86.5186 90.5245 89.9092 87.1505 93.9583 87.2679C98.1033 87.3852 101.433 90.9129 101.302 95.0445ZM93.8583 97.4561C94.3455 97.4468 94.8193 97.2904 95.22 97.0064C95.6208 96.7224 95.9307 96.3234 96.1109 95.8597C96.291 95.396 96.3334 94.8881 96.2326 94.3997C96.1319 93.9114 95.8926 93.4645 95.5447 93.115C95.1968 92.7655 94.7558 92.529 94.2771 92.4352C93.7984 92.3415 93.3034 92.3946 92.8541 92.588C92.4048 92.7813 92.0213 93.1063 91.7517 93.5221C91.4821 93.9379 91.3385 94.4259 91.3388 94.925C91.3465 95.6024 91.6159 96.249 92.0881 96.7234C92.5603 97.1977 93.1968 97.4612 93.8583 97.4561Z"
							fill="white" />
						<path
							d="M57.535 92.2945L64.173 92.2303L64.1764 97.2917L57.5404 97.3563L57.535 92.2945Z"
							fill="white" />
						<path
							d="M66.7248 92.204L73.3495 92.2311L73.4072 96.9883L66.7788 96.9688L66.7248 92.204Z"
							fill="white" />
						<path
							d="M82.599 92.2317L82.5974 97.2812L75.9503 97.3545L75.9523 92.3029L82.599 92.2317Z"
							fill="white" />
						<path
							d="M99.7344 52.3077C99.7118 53.865 99.081 55.3517 97.9768 56.45C96.8726 57.5483 95.3825 58.1711 93.8251 58.1853C90.6172 58.1726 87.9264 55.467 87.9454 52.276C87.9644 49.085 90.6658 46.3773 93.8547 46.3963C95.4125 46.4189 96.8997 47.0499 97.9985 48.1545C99.0972 49.2592 99.7202 50.7498 99.7344 52.3077Z"
							fill="white" />
						<path
							d="M46.3263 57.9008C43.1365 57.9325 40.4194 55.2549 40.3961 52.0436C40.3729 48.8322 43.0395 46.1483 46.2546 46.1124C49.4696 46.0765 52.1467 48.752 52.1847 51.9718C52.2206 55.1579 49.5413 57.8713 46.3263 57.9008Z"
							fill="white" />
					</svg>
				</div>
				
				<h2 class="text-blue-950 ms-2">Ruta de atención al ciudadano</h2>
			</div>
		</div>
		<div class="flex gap-3 mb-5">
			<!-- Sección Derecha (Botón) -->
			<router-link
				:to="{ name: 'PerfilCiudadanoPage' }"
				class="bg-azulApe h-9 rounded-menu no-underline px-3  flex items-center gap-2">
				<img :src="arrowBack" alt="volver">
				<span class="text-white font-bold text-sm text-center items-center justify-center"
					>Regresar a perfil del ciudadano</span
				>
			</router-link>
			

			<!-- Recuadro Blanco (Información del ciudadano) -->
			<div class="flex items-center gap-2">

				<div class="ms-3">
					<span class="text-blue-950  font-bold">Ciudadano: </span>
					<span>{{ userInfo.nombrecompleto }}</span>
				</div>
				<div class="ms-2">
					<span class="text-blue-950 font-bold"> Cédula: </span>
					<span>{{ userInfo.documento }}</span>
				</div>
			</div>

			
		</div>
		<div class="bg-white p-2 shadow-custom rounded-lg">
			<table class="">
				<thead>
					<tr class="">
						<th class="bg-blue-950">
							<div class="flex items-center">
								<img :src="calendario" alt="calendario">

								<span class="pl-2">FECHA</span>
							</div>
						</th>
						<th class="">
							<div class="flex items-center">
								

								<span class="pl-2">TICKET</span>
							</div>
						</th>
						<th class="">
							<div class="flex items-center">
								

								<span class="pl-2">VISUALIZAR</span>
							</div>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td
							v-if="!fetchData.data || fetchData.data?.lenght == 0"
							colspan="3">
							No hay tickets disponibles
						</td>
					</tr>
					<tr v-for="(events, date) in fetchData.data" :key="date">
						<!-- Columna de Fecha -->
						<td class="py-4 px-2">
							<time class="text-lg font-bold text-gray-700">{{
								formatDate(events.fecha_hora)
							}}</time>
						</td>

						<!-- Columna de Información del Evento (Título e Imagen) -->
						<td class="py-4 px-2">
							<div class="flex items-center space-y-2 justify-between">
								<div>
									<p class="font-semibold text-black">
										{{ events.titulo }}
									</p>
									<div v-if="openedGroups[date]" class="mt-2">
										<p class="text-gray-600">{{ events.contenido }}</p>
									</div>
								</div>
								<!-- Mostrar los detalles del evento en la misma celda cuando se haga clic en "Ver más" -->

								<!-- <img
									src=""
									alt="Imagen del evento"
									class="w-14 h-14 rounded-full" /> -->
							</div>
						</td>

						<!-- Columna de Visualización (Botón Ver más) -->
						<td class="py-4 px-2 text-center">
							<div
								@click="toggleEventDetails(date)"
								class="flex items-center justify-center cursor-pointer">
								<!-- Transición entre los íconos SVG -->
								<transition name="fade">
									<svg
										v-if="!openedGroups[date]"
										width="40"
										height="40"
										viewBox="0 0 40 40"
										fill="none"
										xmlns="http://www.w3.org/2000/svg">
										<rect width="40" height="40" rx="20" fill="#FFBF00" />
										<path
											d="M8.63785 21.9416C8.45886 21.7223 7.25547 20.1791 7.27564 20.0319C8.6597 17.8973 10.411 15.9773 12.3984 14.5429C17.6405 10.761 23.4768 10.8088 28.6777 14.6544C30.6004 16.0757 32.2979 17.9488 33.6484 20.031C32.5559 21.7794 31.1786 23.3638 29.6592 24.6585C22.5868 30.6857 14.4312 29.0338 8.63701 21.9407L8.63785 21.9416ZM16.5968 25.626C16.0287 25.1957 15.527 24.5741 15.1506 23.9338C13.569 21.2404 13.8262 17.6723 15.7548 15.2882C15.9674 15.0248 16.2817 14.7838 16.4708 14.5401C16.5119 14.4876 16.5716 14.4632 16.554 14.376C13.706 15.4307 11.174 17.4435 9.28996 20.031C9.27231 20.1416 10.3454 21.3998 10.5034 21.5713C12.1984 23.4154 14.2573 24.8629 16.5094 25.701L16.5968 25.626ZM24.328 25.626L24.4154 25.701C27.2457 24.6435 29.7634 22.6382 31.6357 20.0638C29.7836 17.4491 27.2256 15.4532 24.3902 14.3798L24.328 14.4688C24.4524 14.5298 24.607 14.6713 24.707 14.7735C27.4945 17.6169 27.5062 22.4038 24.7491 25.2744C24.6381 25.3907 24.465 25.551 24.328 25.626ZM20.2439 14.6704C16.3363 14.901 14.2514 19.8988 16.6632 23.3713C18.9271 26.631 23.6163 25.8669 24.9474 22.0279C26.165 18.5151 23.939 14.8241 20.6086 14.6573L20.2431 14.6704H20.2439Z"
											fill="white" />
										<path
											d="M17.9841 19.0158C18.1757 19.0936 18.3194 19.2558 18.5186 19.3336C19.4816 19.7105 20.3884 18.9014 20.2942 17.7736C20.2741 17.5326 20.1514 17.3536 20.1455 17.138C21.2144 16.9289 22.3892 17.6817 22.8455 18.7711C23.4892 20.3067 22.8649 22.1386 21.4581 22.7733C19.3228 23.737 17.2009 21.4073 17.9849 19.0148L17.9841 19.0158Z"
											fill="white" />
									</svg>
								</transition>
								<transition name="fade">
									<svg
										v-if="openedGroups[date]"
										width="39"
										height="38"
										viewBox="0 0 39 38"
										fill="none"
										xmlns="http://www.w3.org/2000/svg">
										<rect width="39" height="38" rx="19" fill="#005DCA" />
										<path
											d="M31.519 14.4216L30.7305 14.3108C30.3515 14.2579 29.9875 14.4857 29.8877 14.8464C26.9991 25.2378 12 25.2378 9.11141 14.8464C9.01159 14.4869 8.64767 14.2579 8.26859 14.3108L7.48009 14.4216C7.03277 14.4844 6.73835 14.9104 6.84829 15.3364C7.27286 16.9924 8.06009 18.5314 9.07224 19.9227C9.27948 20.2083 9.25799 20.5937 9.01664 20.8535L7.5458 22.4307C7.27412 22.7225 7.28297 23.1706 7.56728 23.4514L8.09547 23.9734C8.39116 24.2664 8.87512 24.2689 9.1746 23.9795L10.696 22.5107C10.9613 22.2546 11.3771 22.2226 11.6791 22.4368C12.5143 23.029 13.3849 23.6163 14.3567 23.9537C14.7244 24.0817 14.9367 24.4548 14.8469 24.8242L14.3466 26.8987C14.253 27.2853 14.4893 27.6756 14.8823 27.784L15.6468 27.9933C16.06 28.1066 16.4884 27.8652 16.5933 27.4589L17.1126 25.4385C17.2086 25.063 17.5839 24.8242 17.9756 24.8869C18.9827 25.0482 20.0164 25.0482 21.0222 24.8869C21.4139 24.8242 21.7892 25.063 21.8853 25.4385L22.4046 27.4577C22.5095 27.864 22.9366 28.1053 23.3511 27.9921L24.1155 27.7828C24.5085 27.6744 24.7448 27.2853 24.6513 26.8975L24.1509 24.8229C24.0612 24.4536 24.2735 24.0805 24.6412 23.9525C25.6129 23.6139 26.4835 23.0266 27.3188 22.4356C27.6208 22.2226 28.0365 22.2546 28.3019 22.5095L29.8233 23.9783C30.1227 24.2676 30.6067 24.2652 30.9024 23.9722L31.4306 23.4501C31.7149 23.1694 31.7237 22.7212 31.4521 22.4294L29.9812 20.8523C29.7399 20.5937 29.7184 20.2071 29.9256 19.9215C30.9378 18.5302 31.725 16.9924 32.1496 15.3352C32.2595 14.908 31.9651 14.4832 31.5178 14.4204L31.519 14.4216Z"
											fill="white" />
										<path
											d="M32.1515 15.3364C31.727 16.9924 30.9397 18.5314 29.9276 19.9227C29.7203 20.2083 29.7418 20.5937 29.9832 20.8535L31.454 22.4307C31.7257 22.7225 31.7168 23.1706 31.4325 23.4513L30.9043 23.9734C30.6087 24.2664 30.1247 24.2689 29.8252 23.9795L28.3038 22.5107C28.0385 22.2546 27.6227 22.2226 27.3207 22.4368C26.4855 23.029 25.6149 23.6163 24.6432 23.9537C24.2754 24.0817 24.0632 24.4548 24.1529 24.8241L24.6533 26.8987C24.7468 27.2853 24.5105 27.6756 24.1175 27.784L23.353 27.9933C22.9398 28.1065 22.5114 27.8652 22.4066 27.4589L21.8872 25.4397C21.7912 25.0642 21.4159 24.8254 21.0242 24.8882C20.0183 25.0495 18.9834 25.0495 17.9776 24.8882C17.5859 24.8254 17.2106 25.0642 17.1146 25.4397L16.5952 27.4602C16.4903 27.8665 16.0632 28.1078 15.6488 27.9945L14.8843 27.7852C14.4913 27.6769 14.255 27.2878 14.3485 26.9L14.8489 24.8254C14.9386 24.456 14.7263 24.083 14.3586 23.9549C13.3869 23.6163 12.5163 23.029 11.681 22.4381C11.379 22.2251 10.9633 22.2571 10.6979 22.5119L9.17655 23.9808C8.87707 24.2701 8.39311 24.2676 8.09742 23.9746L7.56923 23.4526C7.28492 23.1719 7.27608 22.7237 7.54775 22.4319L9.0186 20.8547C9.25995 20.5962 9.28143 20.2096 9.0742 19.9239C8.06204 18.5327 7.27481 16.9949 6.85024 15.3377C6.74031 14.9104 7.03473 14.4857 7.48205 14.4229L8.27054 14.3121C8.64962 14.2591 9.01228 14.4869 9.11337 14.8476C12.002 25.2391 27.001 25.2391 29.8897 14.8476C29.9895 14.4881 30.3534 14.2591 30.7325 14.3121L31.521 14.4229C31.9683 14.4857 32.2627 14.9117 32.1528 15.3377L32.1515 15.3364Z"
											fill="white" />
									</svg>
								</transition>
								{{ openedGroups[date] ? "" : "" }}
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</template>

<script setup>
import { ref, onMounted, computed } from "vue";
import { useEventStore } from "@/stores/storedataOff";
import arrowBack from "@/assets/images/arrowBack.svg";
import calendario from "@/assets/images/calendario.svg"

const openedGroups = ref({});
const fetchData = ref([]);
const eventStore = useEventStore();
const userInfo = ref({
	nombrecompleto: "Juan Pérez García",
	documento: "1234567890"
});

const host = import.meta.env.VITE_HOST;

const fetchOptions = {
	url: `${host}:8082/api/v1/victimas/ticket`,
	options: {
		method: "GET",
		headers: {
			Accept: "application/json",
		},
	},
};

const getFetchData = async (fetchOptions) => {
	const { url, options } = fetchOptions;
	let newUrl = url + `/${userInfo.value.documento}`;
	console.log(newUrl);

	try {
		const response = await fetch(newUrl, options);
		const json = await response.json();
		if (!response.ok)
			throw {
				error: true,
				errorStatus: response.status,
				errorMsg: response.statusText,
			};
		console.log(json);
		fetchData.value = json;
	} catch (error) {
		if (!error.error) error.error = true;
		console.log(error);
	} finally {
		newUrl = "";
	}

	fetchData.value = {
		data: [
			{
				fecha_hora: "2024-11-01T10:30:00",
				titulo: "Ticket de Atención Inicial",
				contenido: "Se realizó la primera consulta y registro del caso. Se documentaron los hechos y se asignó un código de seguimiento."
			},
			{
				fecha_hora: "2024-11-05T14:15:00",
				titulo: "Seguimiento Psicológico",
				contenido: "Sesión de apoyo psicológico. Se brindó orientación y se programó próxima cita de seguimiento."
			},
			{
				fecha_hora: "2024-11-10T09:00:00",
				titulo: "Asesoría Legal",
				contenido: "Se proporcionó información sobre derechos y procedimientos legales disponibles. Se entregó documentación necesaria."
			},
			{
				fecha_hora: "2024-11-15T16:45:00",
				titulo: "Revisión de Caso",
				contenido: "Actualización del estado del caso. Se revisaron avances y se establecieron próximos pasos a seguir."
			}
		]
	};
};



const formatDate = (isoDate) => {
	const date = new Date(isoDate);
	return new Intl.DateTimeFormat("es-ES", {
		dateStyle: "medium",
		timeStyle: "short",
	}).format(date);
};

// Función para alternar la visibilidad de los detalles del evento
const toggleEventDetails = (date) => {
	openedGroups.value[date] = !openedGroups.value[date];
};

onMounted(() => {
	getFetchData(fetchOptions);
});
</script>

<style scoped>
/* Aplicar bordes con espaciado */
@import "@/styles/table-styles.css";
</style>
